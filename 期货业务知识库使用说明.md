# 期货业务知识库系统（增强版）

本项目是一个基于知识图谱的期货业务知识管理系统，通过先进的自然语言处理技术，实现对期货业务文档的自动解析、实体识别、关系提取及知识图谱构建。增强版在基础版上新增了模型训练、关系提取增强等核心功能。

## 功能特点

### 基础功能

- **多格式文档解析**：支持PDF、Word、Excel和Markdown格式的期货业务文档解析
- **实体识别与关系提取**：自动识别文档中的合约、规则、期货品种等实体，以及实体间的关系
- **知识图谱构建**：基于Neo4j图数据库构建期货业务知识图谱
- **可视化查询与分析**：通过图形界面展示规则-合约关系，支持多维度的查询
- **高级搜索**：支持关键词搜索、高级筛选和Cypher语句查询

### 增强功能（新增）

- **实体识别模型训练**：基于DeepSeek-7B或其他预训练模型，使用标注数据进行领域适应性微调
- **关系提取增强**：结合规则匹配、依存句法分析和深度学习模型，提升关系提取准确率
- **配置化管理**：灵活配置系统参数、模型路径、API设置等
- **批量处理工具**：提供命令行接口，支持批量处理目录或文件列表
- **知识图谱导出**：支持多种格式导出知识图谱数据（JSON、CSV、Cypher）

## 系统架构

```
期货业务知识库/
├── backend/                      # 后端API服务
│   ├── document_parser.py        # 文档解析模块
│   ├── entity_extraction.py      # 实体提取模块
│   ├── relation_extraction.py    # 关系提取模块（新增）
│   ├── knowledge_graph.py        # 知识图谱管理模块
│   ├── api_service.py            # API服务模块
│   └── knowledge_extraction_pipeline.py  # 知识提取流水线（新增）
│
├── models/                       # 模型训练与管理
│   ├── model_training.py         # NER模型训练模块（新增）
│   ├── relation_model_training.py # 关系模型训练模块（新增）
│   └── trained_models/           # 存放训练好的模型
│
├── tools/                        # 工具脚本
│   ├── batch_extraction.py       # 批量知识提取脚本（新增）
│   ├── data_annotation.py        # 数据标注工具（新增）
│   └── graph_export.py           # 图谱导出工具（新增）
│
├── frontend/                     # 前端Vue3应用
│   ├── src/
│   │   ├── components/           # Vue组件
│   │   └── ...
│   └── ...
│
├── config/                       # 配置文件
│   ├── config.yaml               # 主配置文件（新增）
│   ├── dev.yaml                  # 开发环境配置
│   └── prod.yaml                 # 生产环境配置
│
├── data/                         # 数据目录
│   ├── raw/                      # 原始文档
│   ├── processed/                # 处理后的数据
│   └── annotations/              # 标注数据
│
├── docker/                       # Docker配置
│   ├── docker-compose.yml        # Docker Compose配置
│   ├── backend.Dockerfile        # 后端Docker配置
│   ├── frontend.Dockerfile       # 前端Docker配置
│   └── neo4j.conf                # Neo4j数据库配置
│
└── README.md                     # 项目文档
```

## 安装与部署

### 前提条件

- Python 3.9+
- Neo4j 5.10+
- Docker 和 Docker Compose（可选）
- CUDA兼容GPU（推荐用于模型训练）

### 使用Docker部署

1. 克隆仓库

```bash
git clone https://github.com/your-organization/futures-knowledge-graph.git
cd futures-knowledge-graph
```

1. 编辑配置文件（可选）

```bash
cp config/config.yaml.example config/config.yaml
# 编辑config.yaml，配置数据库连接和其他参数
```

1. 构建并启动服务

```bash
docker-compose up -d
```

1. 访问应用

- 前端界面: `http://localhost`
- API文档: `http://localhost/api/docs`
- Neo4j浏览器: `http://localhost:7474`

### 手动安装

1. 安装Python依赖

```bash
pip install -r requirements.txt
```

1. 安装Neo4j数据库

下载并安装Neo4j（https://neo4j.com/download/）

1. 启动后端服务

```bash
cd backend
python api_service.py
```

1. 启动前端应用

```bash
cd frontend
npm install
npm run serve
```

## 模型训练（新增）

### 实体识别模型训练

```bash
python models/model_training.py \
  --data_path data/annotations/entity_annotations.json \
  --model_name deepseek-ai/deepseek-llm-7b-base \
  --output_dir models/trained_models/futures-ner \
  --epochs 3
```

### 关系分类模型训练

```bash
python models/relation_model_training.py \
  --data_path data/annotations/relation_annotations.json \
  --model_name bert-base-chinese \
  --output_dir models/trained_models/futures-relation \
  --epochs 3
```

## 批量知识提取（新增）

### 处理目录

```bash
python tools/batch_extraction.py \
  --dir data/raw \
  --recursive \
  --extensions .pdf .docx .xlsx \
  --config config/config.yaml \
  --env prod \
  --export output/knowledge_graph.json
```

### 处理文件列表

```bash
python tools/batch_extraction.py \
  --files data/raw/doc1.pdf data/raw/doc2.docx \
  --output output/results \
  --export-format cypher \
  --export output/graph_script.cypher
```

### 处理文本

```bash
python tools/batch_extraction.py \
  --text "根据规则RULE_2024_001，从2024年1月1日起，IF2406合约的保证金比例调整为8%。" \
  --output output/results
```

## API使用示例

```python
import requests

# 上传文档
files = {'file': open('contract.pdf', 'rb')}
response = requests.post('http://localhost:8000/documents/upload', files=files)
doc_id = response.json().get('doc_id')

# 查询图谱数据
response = requests.get('http://localhost:8000/graph/rule-contract', params={'effective_year': 2024})
graph_data = response.json()

# 执行Cypher查询
query_data = {
    'query': 'MATCH (r:RULE)-[:APPLY_TO]->(c:CONTRACT) RETURN r, c LIMIT 10'
}
response = requests.post('http://localhost:8000/cypher', json=query_data)
results = response.json()
```

## 前端界面使用

1. **知识图谱视图**：
   - 浏览期货规则与合约的关系网络
   - 使用年份筛选器查看特定年份的数据
   - 调整保证金比例滑块筛选规则
   - 点击节点查看详细信息
2. **搜索查询视图**：
   - 关键词搜索：输入术语、规则编号或合约代码
   - 高级搜索：按实体类型、属性值进行筛选
   - Cypher查询：编写自定义图数据库查询
3. **文档管理视图**：
   - 上传文档：支持拖拽上传多种格式
   - 查看提取结果：显示文档中识别的实体和关系
   - 管理已处理文档

## 贡献指南

我们欢迎各种形式的贡献，包括但不限于：

- 提交错误报告
- 改进文档
- 添加新功能
- 优化性能
- 提供标注数据

请参阅 [CONTRIBUTING.md](https://claude.ai/chat/CONTRIBUTING.md) 了解更多详情。

## 许可证

[MIT License](https://claude.ai/chat/LICENSE)

## 常见问题

**Q: 系统支持哪些类型的期货业务文档？**
 A: 系统支持PDF、Word、Excel和Markdown格式的文档，包括合约条款、风控规则、行业研报和操作手册等。

**Q: 如何提高实体识别和关系提取的准确率？**
 A: 增加标注数据量，调整模型参数，或编写更精细的规则。系统支持模型和规则的混合使用。

**Q: 使用GPU训练模型有什么要求？**
 A: 建议使用至少8GB显存的CUDA兼容GPU。对于DeepSeek-7B等大模型，建议使用至少16GB显存的GPU。

**Q: 如何导出知识图谱数据？**
 A: 可以使用批处理工具的`--export`选项，或通过API的`/cypher`接口执行查询并保存结果。

**Q: 系统是否支持增量更新知识图谱？**
 A: 是的，系统支持增量更新。新处理的文档会被添加到现有图谱中，并自动建立与已有节点的关系。